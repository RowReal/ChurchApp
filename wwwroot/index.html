<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="ChurchApp - Church Management System" />
    <title>ChurchApp</title>
    <base href="/" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/app.css" rel="stylesheet" />
    <!--<link href="css/dashboard.css" rel="stylesheet" />-->

    <!-- Favicon -->
    <link href="favicon.png" rel="icon" type="image/png" />
</head>
<body>
    <!-- Loading Spinner -->
    <div id="app">
        <div class="d-flex justify-content-center align-items-center" style="height: 100vh;">
            <div class="text-center">
                <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Loading ChurchApp...</span>
                </div>
                <div class="mt-3">
                    <h4>ChurchApp</h4>
                    <p class="text-muted">Loading...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Blazor WebAssembly Script -->
    <script src="_framework/blazor.webassembly.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript for CSV Export and other functionality -->
    <script>
        // CSV Export Function
        function downloadCsv(csvContent, fileName) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            link.setAttribute('href', url);
            link.setAttribute('download', fileName);
            link.style.visibility = 'hidden';

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Print Functionality
        function printElement(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                    <head>
                        <title>Print Report</title>
                        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
                        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
                        <style>
                            @media print {
                                .no-print { display: none !important; }
                                .card { border: 1px solid #ddd !important; }
                                .table { font-size: 12px; }
                            }
                            body { font-family: Arial, sans-serif; }
                            .print-header {
                                text-align: center;
                                margin-bottom: 20px;
                                border-bottom: 2px solid #333;
                                padding-bottom: 10px;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="print-header">
                            <h2>ChurchApp Report</h2>
                            <p>Generated on: ${new Date().toLocaleDateString()}</p>
                        </div>
                        ${element.innerHTML}
                    </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.focus();
                printWindow.print();
                printWindow.close();
            }
        }

        // File Upload Helper
        function setupFileInput(inputId, dotnetHelper, callbackMethod) {
            const input = document.getElementById(inputId);
            if (input) {
                input.addEventListener('change', function (event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            const dataUrl = e.target.result;
                            dotnetHelper.invokeMethodAsync(callbackMethod, dataUrl, file.name, file.type);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        }

        // Image Preview Helper
        function previewImage(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);

            if (input && preview) {
                input.addEventListener('change', function () {
                    const file = this.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.addEventListener('load', function () {
                            preview.src = reader.result;
                            preview.style.display = 'block';
                        });
                        reader.readAsDataURL(file);
                    }
                });
            }
        }

        // Notification Helper
        function showNotification(message, type = 'info') {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.custom-notification');
            existingNotifications.forEach(notification => notification.remove());

            const notification = document.createElement('div');
            notification.className = `custom-notification alert alert-${type} alert-dismissible fade show`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                max-width: 500px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            `;

            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            document.body.appendChild(notification);

            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // Local Storage Helpers
        function setLocalStorage(key, value) {
            localStorage.setItem(key, JSON.stringify(value));
        }

        function getLocalStorage(key) {
            const item = localStorage.getItem(key);
            return item ? JSON.parse(item) : null;
        }

        function removeLocalStorage(key) {
            localStorage.removeItem(key);
        }

        // Scroll to Top Function
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Modal Helpers
        function showModal(modalId) {
            const modal = new bootstrap.Modal(document.getElementById(modalId));
            modal.show();
        }

        function hideModal(modalId) {
            const modal = bootstrap.Modal.getInstance(document.getElementById(modalId));
            if (modal) {
                modal.hide();
            }
        }

        // Date Helpers
        function getCurrentDate() {
            return new Date().toISOString().split('T')[0];
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        // Initialize when document is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ChurchApp initialized');

            // Add print styles
            const style = document.createElement('style');
            style.textContent = `
                @media print {
                    .no-print { display: none !important; }
                    .btn { display: none !important; }
                    .sidebar { display: none !important; }
                    .navbar { display: none !important; }
                    .card-header { background-color: #f8f9fa !important; color: #000 !important; }
                }
            `;
            document.head.appendChild(style);
        });

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
        });

        // Blazor startup error handling
        window.Blazor = {
            start: function() {
                console.log('Blazor WebAssembly starting...');
            }
        };
    </script>
</body>
</html>